<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optional Responsibility Assessments - Expert Response Distribution</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Figtree:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Figtree', Arial, sans-serif;
            margin: 0;
            padding: 5px;
            background-color: transparent;
        }
        
        .matrix-container {
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 0;
            max-width: 650px;
            margin: 0;
        }
        
        .sample-size {
            text-align: center;
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 15px;
        }
        
        .matrix-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 5px;
            table-layout: fixed;
        }
        
        .matrix-table th {
            background-color: transparent;
            padding: 6px 4px;
            text-align: center;
            font-weight: bold;
            border: none;
            font-size: 14px;
        }
        
        .actor-label {
            background-color: transparent;
            padding: 8px 6px;
            font-weight: bold;
            text-align: left;
            border: none;
            border-top: 1px solid #666;
            width: 140px;
            font-size: 15px;
            word-wrap: break-word;
            white-space: normal;
            line-height: 1.3;
            hyphens: auto;
        }
        
        .group-header {
            background-color: #a32035;
            color: white;
            font-weight: bold;
            padding: 6px;
            text-align: left;
            font-size: 16px;
        }
        
        .response-cell {
            padding: 5px 4px;
            text-align: center;
            border: none;
            border-top: 1px solid #666;
            position: relative;
            min-width: 80px;
            background-color: transparent;
            vertical-align: bottom;
        }
        
        .bar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
        }
        
        .distribution-bar {
            width: 50px;
            border-radius: 3px 3px 0 0;
            transition: height 0.4s ease;
            min-height: 3px;
            position: relative;
            margin-bottom: 4px;
            border: 1px solid #666;
        }
        
        .bar-label {
            text-align: center;
            font-size: 11px;
            font-weight: bold;
            color: #333;
            line-height: 1.1;
            padding: 2px 4px;
        }
        
        .participant-count {
            font-size: 10px;
            color: #666;
            margin-top: 1px;
        }
        
        .median-indicator {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            color: #ea4335;
            z-index: 10;
        }
        
        .legend {
            margin-top: 15px;
            padding: 0;
            background-color: transparent;
            border-radius: 0;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: #5f6368;
        }
        
        .legend-arrow {
            font-size: 14px;
            color: #ea4335;
        }
        
        .legend-bar {
            width: 20px;
            height: 16px;
            background-color: #1a73e8;
            border-radius: 3px;
            box-shadow: 0 2px 4px rgba(26, 115, 232, 0.3);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #c41e3a;
            background-color: #f8d7da;
            border-radius: 4px;
            margin: 20px 0;
        }
        
        .qualitative-dropdown {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #f9f9f9;
        }
        
        .dropdown-header {
            padding: 12px 15px;
            background-color: #e8f4f8;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #2c5aa0;
            transition: background-color 0.2s ease;
        }
        
        .dropdown-header:hover {
            background-color: #d4e7f0;
        }
        
        .dropdown-arrow {
            font-size: 12px;
            transition: transform 0.3s ease;
        }
        
        .dropdown-arrow.expanded {
            transform: rotate(180deg);
        }
        
        .dropdown-content {
            display: none;
            padding: 15px;
            background-color: white;
            border-radius: 0 0 6px 6px;
        }
        
        .dropdown-content.show {
            display: block;
        }
        
        .justification-section {
            margin-bottom: 15px;
        }
        
        .justification-title {
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .justification-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .justification-list li {
            margin-bottom: 4px;
            line-height: 1.4;
            color: #555;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div style="display: inline-block; border: 2px solid #4caf50; border-radius: 4px; padding: 5px; margin: 5px 0;">
        <div style="background-color: #4caf50; color: white; padding: 4px 8px; margin: -5px -5px 5px -5px; border-radius: 2px 2px 0 0; font-weight: bold; font-size: 14px; text-align: right;">
            ‚ö†Ô∏è Aggregated R1 Expert Judgements - Please Review Before Submitting Revised Assessments
        </div>
        <div class="matrix-container">
            <div id="loadingMessage" class="loading">Loading expert response data...</div>
            <div id="errorMessage" class="error" style="display: none;">Risk data not found. Please check the URL parameter.</div>
        
        <div id="mainContent" style="display: none;">
            <table class="matrix-table">
                <thead>
                    <tr>
                        <th style="width: 140px;"></th>
                        <th>Not responsible</th>
                        <th>Minimally responsible</th>
                        <th>Moderately responsible</th>
                        <th>Highly responsible</th>
                        <th>Primarily responsible</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-actor="ai_infra">
                        <td class="actor-label">
                            AI Infrastructure Provider
                        </td>
                        <td class="response-cell" data-response="not_responsible"></td>
                        <td class="response-cell" data-response="minimally_responsible"></td>
                        <td class="response-cell" data-response="moderately_responsible"></td>
                        <td class="response-cell" data-response="highly_responsible"></td>
                        <td class="response-cell" data-response="primarily_responsible"></td>
                    </tr>
                    <tr data-actor="ai_dev_spec">
                        <td class="actor-label">
                            AI Developer (Specialized AI)
                        </td>
                        <td class="response-cell" data-response="not_responsible"></td>
                        <td class="response-cell" data-response="minimally_responsible"></td>
                        <td class="response-cell" data-response="moderately_responsible"></td>
                        <td class="response-cell" data-response="highly_responsible"></td>
                        <td class="response-cell" data-response="primarily_responsible"></td>
                    </tr>
                    <tr data-actor="ai_stake">
                        <td class="actor-label">
                            Affected Stakeholder
                        </td>
                        <td class="response-cell" data-response="not_responsible"></td>
                        <td class="response-cell" data-response="minimally_responsible"></td>
                        <td class="response-cell" data-response="moderately_responsible"></td>
                        <td class="response-cell" data-response="highly_responsible"></td>
                        <td class="response-cell" data-response="primarily_responsible"></td>
                    </tr>
                </tbody>
            </table>
            
            <div class="legend">
                <div class="legend-item">
                    <span class="legend-arrow">‚ñº</span>
                    <span>Median responsibility level (50th percentile)</span>
                </div>
            </div>
            
            <div class="qualitative-dropdown" id="qualitativeDropdown">
                <div class="dropdown-header" onclick="toggleDropdown()">
                    <span>üìù Expert Qualitative Justifications</span>
                    <span class="dropdown-arrow" id="dropdownArrow">‚ñº</span>
                </div>
                <div class="dropdown-content" id="dropdownContent">
                    <div id="justificationContent">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script>
        // Sample responsibility data for optional assessments
        const expertDataStore = {
            'responsibility': {
                data: {
                    ai_infra: { not_responsible: 5, minimally_responsible: 12, moderately_responsible: 6, highly_responsible: 2, primarily_responsible: 0 },
                    ai_dev_spec: { not_responsible: 3, minimally_responsible: 8, moderately_responsible: 9, highly_responsible: 4, primarily_responsible: 1 },
                    ai_stake: { not_responsible: 0, minimally_responsible: 2, moderately_responsible: 5, highly_responsible: 8, primarily_responsible: 10 }
                },
                totalExperts: 25
            }
        };
        
        // Qualitative justifications from experts for optional responsibility assessments
        const qualitativeJustifications = {
            'responsibility': {
                high_responsibility: [
                    "Infrastructure providers control fundamental computing resources that enable AI systems",
                    "Specialized AI developers create domain-specific systems with targeted impacts",
                    "Affected stakeholders bear the ultimate consequences of AI decisions and should have agency in governance",
                    "Infrastructure providers have technical expertise to implement safety measures at the foundational level",
                    "Stakeholders have legitimate interests that should be prioritized in responsibility allocation"
                ],
                moderate_responsibility: [
                    "Responsibility should be distributed across the AI value chain rather than concentrated",
                    "Different actors have varying degrees of control and influence over AI outcomes",
                    "Technical complexity makes it difficult to assign clear responsibility boundaries",
                    "Market dynamics and regulatory frameworks shape individual actor responsibilities"
                ],
                low_responsibility: [
                    "Infrastructure providers operate at too high a level of abstraction to influence specific use cases",
                    "Individual stakeholders lack the technical knowledge to meaningfully govern AI systems",
                    "Systemic issues require coordinated action beyond individual actor responsibility",
                    "Specialized AI developers may have limited control over downstream deployment decisions"
                ]
            }
        };
        
        let expertData = {};
        let totalExperts = 25;
        
        function calculateMedian(responses) {
            const responseOrder = ['not_responsible', 'minimally_responsible', 'moderately_responsible', 'highly_responsible', 'primarily_responsible'];
            const counts = responseOrder.map(key => responses[key] || 0);
            const total = counts.reduce((sum, count) => sum + count, 0);
            
            if (total === 0) return null;
            
            let runningSum = 0;
            for (let i = 0; i < responseOrder.length; i++) {
                runningSum += counts[i];
                if (runningSum >= total / 2) {
                    return responseOrder[i];
                }
            }
            return responseOrder[responseOrder.length - 1];
        }

        function findMode(responses) {
            const responseOrder = ['not_responsible', 'minimally_responsible', 'moderately_responsible', 'highly_responsible', 'primarily_responsible'];
            let maxCount = 0;
            let mode = null;
            
            responseOrder.forEach(responseType => {
                const count = responses[responseType] || 0;
                if (count > maxCount) {
                    maxCount = count;
                    mode = responseType;
                }
            });
            
            return mode;
        }

        function initializeData() {
            const riskData = expertDataStore['responsibility'];
            expertData = riskData.data;
            totalExperts = riskData.totalExperts;
            
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            updateVisualization();
        }
        
        function updateVisualization() {
            const actors = Object.keys(expertData);
            
            actors.forEach((actor, index) => {
                const row = document.querySelector(`tr[data-actor="${actor}"]`);
                if (!row) return;
                
                // Add alternating row colors (skip header rows in count)
                const dataRows = document.querySelectorAll('tr[data-actor]');
                const actorIndex = Array.from(dataRows).indexOf(row);
                const isEven = actorIndex % 2 === 0;
                const backgroundColor = isEven ? '#f0f0f0' : 'white';
                
                // Apply background to all cells in the row
                const cells = row.querySelectorAll('td');
                cells.forEach(cell => {
                    cell.style.backgroundColor = backgroundColor;
                });
                
                const responses = expertData[actor];
                const total = Object.values(responses).reduce((a, b) => a + b, 0);
                const median = calculateMedian(responses);
                const mode = findMode(responses);
                
                // Calculate the maximum percentage for this row to determine row height
                const percentages = Object.values(responses).map(count => 
                    total > 0 ? (count / total * 100) : 0
                );
                const maxPercentage = Math.max(...percentages);
                const maxBarHeight = Math.max(maxPercentage * 1.2, 3);
                
                // Set dynamic row height based on max bar height with constraints
                const minRowHeight = 60;
                const maxRowHeight = 120;
                const rowHeight = Math.min(Math.max(maxBarHeight + 35, minRowHeight), maxRowHeight);
                
                Object.keys(responses).forEach(responseType => {
                    const cell = row.querySelector(`.response-cell[data-response="${responseType}"]`);
                    if (!cell) return;
                    
                    const count = responses[responseType];
                    const percentage = total > 0 ? (count / total * 100) : 0;
                    
                    // Clear the cell
                    cell.innerHTML = '';
                    
                    // Create bar wrapper with dynamic height
                    const barWrapper = document.createElement('div');
                    barWrapper.className = 'bar-wrapper';
                    barWrapper.style.height = rowHeight + 'px';
                    
                    // Create the vertical bar
                    const bar = document.createElement('div');
                    bar.className = 'distribution-bar';
                    const barHeight = Math.max(percentage * 1.2, 3);
                    bar.style.height = barHeight + 'px';
                    
                    // Set color based on responsibility level (matching vulnerability scale)
                    const responsibilityColors = {
                        'not_responsible': '#2c7bb6',        // Blue - least responsible
                        'minimally_responsible': '#abd9e9',  // Light blue
                        'moderately_responsible': '#ffffbf', // Yellow
                        'highly_responsible': '#fdae61',     // Orange
                        'primarily_responsible': '#d7191c'   // Red - most responsible
                    };
                    bar.style.backgroundColor = responsibilityColors[responseType] || '#4285f4';
                    
                    // Add median indicator
                    if (responseType === median) {
                        const medianArrow = document.createElement('div');
                        medianArrow.className = 'median-indicator';
                        medianArrow.textContent = '‚ñº';
                        bar.appendChild(medianArrow);
                    }
                    
                    // Create label with percentage and participant count
                    const label = document.createElement('div');
                    label.className = 'bar-label';
                    label.textContent = `${Math.round(percentage)}% (${count})`;
                    
                    barWrapper.appendChild(bar);
                    barWrapper.appendChild(label);
                    
                    cell.appendChild(barWrapper);
                });
            });
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
        });
        
        // Dropdown functionality
        function toggleDropdown() {
            const content = document.getElementById('dropdownContent');
            const arrow = document.getElementById('dropdownArrow');
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                arrow.classList.remove('expanded');
            } else {
                content.classList.add('show');
                arrow.classList.add('expanded');
                updateJustificationContent();
            }
        }
        
        function updateJustificationContent() {
            const contentDiv = document.getElementById('justificationContent');
            const riskJustifications = qualitativeJustifications['responsibility'];
            
            if (!riskJustifications) {
                contentDiv.innerHTML = '<p style="color: #666; font-style: italic;">No qualitative justifications available for responsibility assessments.</p>';
                return;
            }
            
            let html = '';
            
            if (riskJustifications.high_responsibility && riskJustifications.high_responsibility.length > 0) {
                html += `
                    <div class="justification-section">
                        <div class="justification-title">üî¥ High/Primary Responsibility Arguments:</div>
                        <ul class="justification-list">
                            ${riskJustifications.high_responsibility.map(point => `<li>${point}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            if (riskJustifications.moderate_responsibility && riskJustifications.moderate_responsibility.length > 0) {
                html += `
                    <div class="justification-section">
                        <div class="justification-title">üü° Moderate Responsibility Arguments:</div>
                        <ul class="justification-list">
                            ${riskJustifications.moderate_responsibility.map(point => `<li>${point}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            if (riskJustifications.low_responsibility && riskJustifications.low_responsibility.length > 0) {
                html += `
                    <div class="justification-section">
                        <div class="justification-title">üü¢ Low/Minimal Responsibility Arguments:</div>
                        <ul class="justification-list">
                            ${riskJustifications.low_responsibility.map(point => `<li>${point}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            contentDiv.innerHTML = html || '<p style="color: #666; font-style: italic;">No qualitative justifications available for responsibility assessments.</p>';
        }
        
    </script>
</body>
</html>